# Crypto Exchange & Custom DBMS

Микросервисная реализация криптовалютной биржи с использованием собственного движка базы данных на C++ и бэкенда на Go.

## Архитектура

Проект состоит из трех основных компонентов, развернутых через Docker Compose:

1. **Backend (Go):** API-шлюз и бизнес-логика (матчинг ордеров, управление балансами).
2. **Database (C++):** Собственная реляционная СУБД с поддержкой SQL-подобного синтаксиса.
3. **Nginx:** Reverse proxy для маршрутизации запросов.
4. **Trading Bots:** Эмуляция рыночной активности.

## Технологический стек

* **Языки:** C++17 (Database), Go 1.20+ (API, Bots).
* **Сетевое взаимодействие:** TCP (DB protocol), HTTP (REST API).
* **Хранение:** CSV-файлы с шардированием (Custom storage engine).
* **Инфраструктура:** Docker, Docker Compose.

## 1. Custom Database (C++)

Реализована с нуля, работает как TCP-сервер (порт 7432).

**Ключевые особенности:**

* **Структура:** Данные хранятся в CSV, конфигурация схемы через `schema.json`.
* **Индексация:** Хеш-индексы для ускорения поиска (`Set<Key, FileLocation>`).
* **Concurrency:** Потокобезопасность на уровне таблиц (`std::shared_mutex`, `LockGuard`).
* **SQL Parser:** Поддержка подмножества SQL.

**Поддерживаемые операции:**

* `INSERT INTO table VALUES(...)` — вставка с поддержкой автоинкремента PK.
* `SELECT ... FROM ... WHERE ...` — выборка с фильтрацией (`AND`, `OR`) и поддержкой `JOIN`.
* `DELETE FROM ... WHERE ...` — удаление записей.
* `VACUUM table` — очистка "мертвых" записей и пересборка файлов хранилища.

## 2. API Exchange (Go)

RESTful API для взаимодействия с клиентами. Реализует логику "стакана" (Order Book) и холдирования средств.

**Эндпоинты:**

* `POST /user` — Регистрация пользователя (выдача API Key).
* `GET /balance` — Получение баланса (свободные и зарезервированные средства).
* `GET /lot`, `GET /pair` — Справочники валют и торговых пар.
* `GET /order` — Список активных ордеров.
* `POST /order` — Создание лимитного ордера (Buy/Sell). Автоматический матчинг.
* `DELETE /order` — Отмена ордера.

## 3. Торговые боты

В комплекте идут скрипты для эмуляции торгов:

* **Random Bot:** Хаотичная торговля для создания нагрузки.
* **Smart Bot:** Анализ стакана и торговля по стратегии (жадность/паника) относительно "справедливой цены".

## Установка и запуск

Требуется Docker и Docker Compose.

1. **Сборка и запуск:**
```
docker-compose up --build
```

2. **Инициализация БД:**
При первом старте сервис `exchange` автоматически создаст структуру таблиц и заполнит справочники (`lots`, `pairs`) согласно `config.json`.
3. **Запуск ботов (опционально):**
```
cd bots
go run bots.go client.go
```

## Конфигурация

* **`schema.json`**: Определение таблиц БД (user, lot, pair, order, user_lot, hold) и лимитов строк на файл.
* **`config.docker.json`**: Настройки подключения API к БД и список поддерживаемых валют.
